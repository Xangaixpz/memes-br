<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memes BR - Pinterest Integration</title>
    <style>
        .meme-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }
        .meme-item {
            min-width: 230px;
            max-width: 280px;
            background: #fffbe7;
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }
        .meme-item:hover {
            transform: translateY(-5px);
        }
        .meme-img {
            width: 100%;
            max-width: 220px;
            max-height: 220px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
        }
        .meme-description {
            font-size: 14px;
            color: #333;
            margin: 8px 0 0 0;
            font-weight: 500;
        }
        .loading {
            color: #43a047;
            font-size: 16px;
            text-align: center;
            margin: 20px;
        }
        .error {
            color: #d32f2f;
            font-size: 16px;
            text-align: center;
            margin: 20px;
        }
        .refresh-btn {
            padding: 10px 20px;
            background: #43a047;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: background 0.3s ease;
        }
        .refresh-btn:hover {
            background: #388e3c;
        }
        .stats {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>

<!-- Categoria Engra√ßados (Internacionais) - Imgflip -->
<h3 style="color:#4CAF50; margin-top:32px;">üåç Engra√ßados (Internacionais)</h3>
<button id="refresh-int" class="refresh-btn">
  üîÑ Trocar Memes Internacionais
</button>
<div id="engracados-scroll-int" class="meme-container">
  <!-- Memes din√¢micos aqui -->
</div>
<div id="engracados-loading-int" class="loading">Carregando memes internacionais...</div>

<!-- Categoria Engra√ßados (BR) - Pinterest API -->
<h3 style="color:#43a047; margin-top:32px;">üáßüá∑ Engra√ßados (BR) - Pinterest</h3>
<div class="stats" id="pinterest-stats">
  Fonte: <a href="https://br.pinterest.com/iamjujurobert/memes-br" target="_blank">Pinterest Memes BR</a>
</div>
<button id="refresh-br-pinterest" class="refresh-btn">
  üîÑ Gerar Novos Memes BR
</button>
<div id="memes-br-pinterest" class="meme-container">
  <!-- Memes do Pinterest aqui -->
</div>
<div id="pinterest-loading" class="loading">Carregando memes brasileiros do Pinterest...</div>

<!-- Categoria Original (BR) - MemeStore API -->
<h3 style="color:#43a047; margin-top:32px;">üé≤ Meme BR Aleat√≥rio</h3>
<div id="meme-br-original" style="margin-bottom:16px;"></div>
<button id="refresh-br-original" class="refresh-btn">
  üîÑ Gerar Outro Meme BR
</button>
<div id="engracados-loading-br" class="loading">Carregando meme brasileiro...</div>

<script>
// Configura√ß√£o da API
const API_BASE_URL = 'http://localhost:5000'; // Altere para seu servidor
const FALLBACK_ENABLED = true;

// INTERNACIONAIS (IMGFLIP) - Mantendo o c√≥digo original
const memesBatchInt = 8;
let memesDataInt = [];

async function fetchMemesInt() {
  document.getElementById('engracados-loading-int').style.display = 'block';
  try {
    const res = await fetch('https://api.imgflip.com/get_memes');
    const data = await res.json();
    memesDataInt = data.data.memes;
    showMemesInt();
  } catch (e) {
    document.getElementById('engracados-scroll-int').innerHTML = '<div class="error">Erro ao carregar memes internacionais.</div>';
  }
  document.getElementById('engracados-loading-int').style.display = 'none';
}

function shuffleArray(arr) {
  return arr.slice().sort(() => Math.random() - 0.5);
}

function showMemesInt() {
  const container = document.getElementById('engracados-scroll-int');
  container.innerHTML = '';
  const shuffled = shuffleArray(memesDataInt);
  
  for (let i = 0; i < Math.min(memesBatchInt, shuffled.length); i++) {
    const meme = shuffled[i];
    const memeDiv = document.createElement('div');
    memeDiv.className = 'meme-item';
    memeDiv.innerHTML = `
      <img src="${meme.url}" alt="${meme.name}" class="meme-img" onclick="openFullscreen('${meme.url}', '${meme.name}')">
      <p class="meme-description">${meme.name}</p>
    `;
    container.appendChild(memeDiv);
  }
}

// BRASILEIROS (PINTEREST API) - Nova implementa√ß√£o
async function fetchMemesBRPinterest(count = 8) {
  document.getElementById('pinterest-loading').style.display = 'block';
  const container = document.getElementById('memes-br-pinterest');
  
  try {
    const response = await fetch(`${API_BASE_URL}/api/memes/br/batch?count=${count}`);
    const data = await response.json();
    
    if (data.success && data.memes) {
      container.innerHTML = '';
      
      data.memes.forEach(meme => {
        const memeDiv = document.createElement('div');
        memeDiv.className = 'meme-item';
        memeDiv.innerHTML = `
          <img src="${meme.image_url}" alt="${meme.description}" class="meme-img" 
               onclick="openFullscreen('${meme.image_url}', '${meme.description}')"
               onerror="this.parentElement.style.display='none'">
          <p class="meme-description">${meme.description}</p>
        `;
        container.appendChild(memeDiv);
      });
      
      // Atualiza estat√≠sticas
      document.getElementById('pinterest-stats').innerHTML = `
        üìä ${data.count} memes carregados | 
        üïí ${new Date(data.timestamp * 1000).toLocaleTimeString()} | 
        üìå <a href="https://br.pinterest.com/iamjujurobert/memes-br" target="_blank">Fonte: ${data.source}</a>
      `;
    } else {
      throw new Error(data.error || 'Resposta inv√°lida da API');
    }
  } catch (error) {
    console.error('Erro ao buscar memes do Pinterest:', error);
    
    if (FALLBACK_ENABLED) {
      // Fallback: usar API original
      container.innerHTML = `
        <div class="error">
          ‚ùå Erro ao carregar do Pinterest. Usando fonte alternativa...
        </div>
      `;
      await fetchMemesBROriginal();
    } else {
      container.innerHTML = `
        <div class="error">
          ‚ùå Erro ao carregar memes do Pinterest: ${error.message}
        </div>
      `;
    }
  }
  
  document.getElementById('pinterest-loading').style.display = 'none';
}

// BRASILEIROS (MemeStore API) - Mantendo como fallback
async function fetchMemesBROriginal() {
  try {
    const res = await fetch("https://meme-api.up.railway.app/meme/random/tag/true");
    const html = await res.text();
    
    // Cria um container espec√≠fico para o meme original
    const originalContainer = document.getElementById('meme-br-original');
    originalContainer.innerHTML = `
      <div class="meme-item" style="margin: 0 auto; display: inline-block;">
        ${html}
      </div>
    `;
  } catch (e) {
    document.getElementById('meme-br-original').innerHTML = `
      <div class="error">‚ùå Erro ao carregar meme brasileiro original.</div>
    `;
  }
}

async function gerarMemeBR() {
  document.getElementById("engracados-loading-br").style.display = "block";
  await fetchMemesBROriginal();
  document.getElementById("engracados-loading-br").style.display = "none";
}

// Fun√ß√£o para abrir imagem em tela cheia
function openFullscreen(imageUrl, description) {
  const modal = document.createElement('div');
  modal.style = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    cursor: pointer;
  `;
  
  modal.innerHTML = `
    <div style="text-align: center; max-width: 90%; max-height: 90%;">
      <img src="${imageUrl}" alt="${description}" style="max-width: 100%; max-height: 80vh; object-fit: contain;">
      <p style="color: white; margin-top: 20px; font-size: 18px;">${description}</p>
      <p style="color: #ccc; margin-top: 10px; font-size: 14px;">Clique para fechar</p>
    </div>
  `;
  
  modal.onclick = () => document.body.removeChild(modal);
  document.body.appendChild(modal);
}

// Event Listeners
document.getElementById('refresh-int').onclick = showMemesInt;
document.getElementById('refresh-br-pinterest').onclick = () => fetchMemesBRPinterest(8);
document.getElementById('refresh-br-original').onclick = gerarMemeBR;

// Inicializa√ß√£o
document.addEventListener('DOMContentLoaded', function() {
  // Carrega memes internacionais
  fetchMemesInt();
  
  // Carrega memes do Pinterest
  fetchMemesBRPinterest(8);
  
  // Carrega um meme BR original
  gerarMemeBR();
  
  console.log('üé≠ Memes BR - Pinterest Integration carregado!');
  console.log('üìå Fonte Pinterest:', 'https://br.pinterest.com/iamjujurobert/memes-br');
});

// Auto-refresh a cada 5 minutos para memes do Pinterest
setInterval(() => {
  fetchMemesBRPinterest(8);
}, 5 * 60 * 1000);

</script>

<style>
/* Estilos adicionais para responsividade */
@media (max-width: 768px) {
  .meme-container {
    gap: 10px;
  }
  
  .meme-item {
    min-width: 200px;
    max-width: 250px;
  }
  
  .refresh-btn {
    font-size: 14px;
    padding: 8px 16px;
  }
}
</style>

</body>
</html> 